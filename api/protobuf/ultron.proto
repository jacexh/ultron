syntax = "proto3";

package wosai.ultron;

option go_package = "github.com/wosai/ultron/v2/internal/genproto";

import "statistics.proto";

service UltronService {
    rpc Connect(Session) returns (stream Event) {}
    rpc Submit(RequestSubmit) returns (ResponseSubmit) {}
}

message Session {
    string slave_id = 1;
    map<string, string> extras = 2;
}

enum EventType {
    PING = 0;
    CONNECTED = 1;
    DISCONNECT = 2;
    PLAN_STARTED = 3;
    PLAN_FINISHED = 4;
    PLAN_INTERRUPTED = 5;
    NEXT_STAGE_STARTED = 6;
    STATS_AGGREGATE = 7;  // 上报
}

message TimerDTO {
    string type = 1;
    bytes timer = 2;
}

message AttackStrategyDTO {
    string type = 1;
    bytes attack_strategy = 2;
}

message Event {
    EventType type = 1;
    oneof data {
        string plan_name = 2;
        AttackStrategyDTO attack_strategy = 3;
        TimerDTO timer = 4;
    };
}

message RequestSubmit {
    uint32 batch_id = 1;
    AttackStatisticsDTO stats =2;
}


message ResponseSubmit {
    enum Result {
        ACCEPTED = 0;
        BATCH_EXPIRED = 1;
        UNKNOWN_JOB = 2;
        UNKNOWN_BATCH = 3;
    }
    string job_id = 1;
    string batch_id = 2;
    Result result = 3;
}
